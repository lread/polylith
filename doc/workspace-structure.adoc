= Build
:toc:

The _poly_ tool gives us access to the data structure that represents the workspace,
which is the same structure that all the poly commands operate on.

Here we will use the output from the https://github.com/polyfy/polylith/tree/master/examples/doc-example[example in the documentation].

To list all the keys at the root, execute this from the _examples/doc-example_ directory:

[source,shell]
----
poly ws get:keys
----

[source,shell]
----
[:bases
 :changes
 :components
 :configs
 :interfaces
 :messages
 :name
 :paths
 :projects
 :settings
 :user-input
 :version
 :ws-dir
 :ws-local-dir
 :ws-reader
 :ws-type]
----

An even better way is to explore the workspace interactively from a xref:commands.adoc#shell[shell]:

image::images/workspace-structure/shell.png[alt=shell]

== bases

[source,shell]
----
poly ws get:bases:user-api
----

[source,clojure]
----
{:base-deps {:src [], :test []},
 :interface-deps {:src ["user"], :test []},
 :lib-deps {:src {"slacker/slacker" {:size 28408,
                                     :type "maven",
                                     :version "0.17.0"}}},
 :lib-imports {:src ["se.example.user-api.api" "slacker.server"],
               :test ["clojure.test" "se.example.user-api.core"]},
 :lines-of-code {:src 13, :test 6},
 :name "user-api",
 :namespaces {:src [{:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/bases/user-api/src/se/example/user_api/core.clj",
                     :imports ["se.example.user-api.api" "slacker.server"],
                     :name "core",
                     :namespace "se.example.user-api.core"}
                    {:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/bases/user-api/src/se/example/user_api/api.clj",
                     :imports ["se.example.user.interface"],
                     :name "api",
                     :namespace "se.example.user-api.api"}],
              :test [{:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/bases/user-api/test/se/example/user_api/core_test.clj",
                      :imports ["clojure.test" "se.example.user-api.core"],
                      :name "core-test",
                      :namespace "se.example.user-api.core-test"}]},
 :paths {:src ["src" "resources"], :test ["test"]},
 :type "base"}
----

* `:base-deps` Lists the bases this base depends on.

* `:interface-deps` Lists the interfaces this base depends on.
Here it depends on the _user_ interface from the _src_ context.
This is because the _se.example.user-api.api_ namespace imports _se.example.user.interface_. +
No interfaces are imported from the test context in this example.

* `:lib-deps` Lists the library dependencies this base depends on,
defined in the _:deps_ key in its _deps.edn_ file for the _src_ context,
and the _:aliases_ > _:test_ > _:extra-deps_ for the _test_ context.
The _:size_ is in bytes.

* `:lib-imports` The name is a bit misleading as internal namespaces for the base is also included.
** `:src` Lists all imports from the src context except component interfaces.
** `:test` Lists all imports from the test context except component interfaces.

* `:lines-of-code` The total number of lines of code for this base (all namespaces included).

* `:name` The name of the directory for this base under the _bases_ directory.

* `:namespaces`
** `:src` Lists all the namespaces that live under the src directory.
*** `:file-path` The absolute path to the namespace.
*** `:imports` Lists all its namespaces.
*** `:is-ignored` Set to true if the namespace is ignored
(by specifying it in the key _:ignored-files_ in workspace.edn.
If ignored, then xref:validations.adoc#warning206[_warning 206 - Unreadable namespace_] will not be triggered.
*** `:is-invalid` Set to true if the namespace is missing or if the file can't be parsed.
*** `:name` The name of the namespace where top namespace + base name (_se.example_ + user-api in this case) have been stripped away.
*** `:namespace` The full name of the namespace.
** `:test` Lists all the namespaces that live under the test directory (same keys as for the _:src_).
* `:non-top-namespace` If the base contains any non-top namespaces, they will be stored in a vector with elements like this:
** {_:non-top-ns_ "com.wrong", _:file_ "bases/cli/src/com/wrong/cli/interface.clj"}
* `:paths` The paths that are specified in its _deps.edn_ file
(paths for _src_ and _resources_ paths + _aliases_ > _:test_ > _:extra-paths_ for test paths).
* `:type` Set to "base".

== changes

[source,shell]
----
poly ws get:changes since:b339c35
----

[source,clojure]
----
{:changed-bases ["cli" "user-api"],
 :changed-components ["user" "user-remote"],
 :changed-files ["bases/cli/deps.edn"
                 "bases/cli/resources/cli/.keep"
                 "bases/cli/src/se/example/cli/core.clj"
                 "bases/cli/test/se/example/cli/core_test.clj"
                 "bases/user-api/deps.edn"
                 "bases/user-api/resources/user-api/.keep"
                 "bases/user-api/src/se/example/user_api/api.clj"
                 "bases/user-api/src/se/example/user_api/core.clj"
                 "bases/user-api/test/se/example/user_api/core_test.clj"
                 "components/user-remote/deps.edn"
                 "components/user-remote/resources/user-remote/.keep"
                 "components/user-remote/src/se/example/user/core.clj"
                 "components/user-remote/src/se/example/user/interface.clj"
                 "components/user-remote/test/se/example/user/interface_test.clj"
                 "components/user/deps.edn"
                 "components/user/resources/user/.keep"
                 "components/user/src/se/example/user/core.clj"
                 "components/user/src/se/example/user/interface.clj"
                 "components/user/test/se/example/user/interface_test.clj"
                 "deps.edn"
                 "development/src/dev/lisa.clj"
                 "projects/command-line/deps.edn"
                 "projects/command-line/test/project/command_line/dummy_test.clj"
                 "projects/user-service/deps.edn"
                 "readme.txt"
                 "scripts/build-cli-uberjar.sh"
                 "scripts/build-uberjar.sh"
                 "scripts/build-user-service-uberjar.sh"
                 "workspace.edn"],
 :changed-or-affected-projects ["command-line" "development" "user-service"],
 :changed-projects ["command-line" "development" "user-service"],
 :git-diff-command "git diff b339c35 --name-only",
 :project-to-bricks-to-test {"command-line" ["cli" "user-remote"],
                             "development" [],
                             "user-service" ["user" "user-api"]},
 :project-to-indirect-changes {"command-line" {:src [], :test []},
                               "development" {:src [], :test []},
                               "user-service" {:src [], :test []}},
 :project-to-projects-to-test {"command-line" [],
                               "development" [],
                               "user-service" []},
 :since "b339c35",
 :since-sha "b339c35"}
----

* `:changed-bases` Lists the changed bases since the sha _b339c35_ (or last stable point in time if :since is not given).

* `:changed-components` Lists the changed components since the sha _b339c35_ (or last stable point in time if _:since_ is not given).

[#changed-files]
* `:changed-files` The same list that is returned by `poly diff since:b339c35`.
The keys _:changed-bases_, _:changed-components_ and _:changed-projects_ are calculated from this list.

* `:changed-or-affected-projects` Lists the projects that are directly or indirectly changed.
A project will be marked as changed if a file in its project directory has changed, or if a file in the bricks it includes has changed.

* `:changed-projects` Lists the changed projects since the sha _b339c35_ (or last stable point in time if _:since_ is not given).

* `:git-diff-command` The git command that was executed to calculate the _:changed-files_ list.

* `:project-to-bricks-to-test` A map that stores project names with a list of the bricks to test from that project if executing the test command.

* `:project-to-indirect-changes` A map that stores project names with a list of the bricks that are indirectly changed
(directly changed bricks excluded). E.g. if components _a_ and _b_ are included in the project,
and _a_ has not changed, but _b_ has changed and _a_ uses _b_, then _b_ will be included in the list.

* `:project-to-projects-to-test` A map that stores project names with a list of projects to test from that project
if executing the xref:commands.adoc#test[test] command.

* `:since` Set to "stable" if _since:SINCE_ is not given.

* `:since-sha` The full sha if _since:SINCE_ was not given, e.g. _b339c358079fa36ca20ed0163708ba010a0ffd4c_.

* `:since-tag` The name of the tag, e.g. v_0.1.0-alpha9_ if _since:release_ was given.

== components

[source,shell]
----
poly ws get:components:user
----

[source,clojure]
----
{:interface {:definitions [{:name "hello",
                            :parameters [{:name "name"}],
                            :type "function"}],
             :name "user"},
 :interface-deps {:src [], :test []},
 :lib-deps {},
 :lib-imports {:test ["clojure.test"]},
 :lines-of-code {:src 9, :test 7},
 :name "user",
 :namespaces {:src [{:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/components/user/src/se/example/user/interface.clj",
                     :imports ["se.example.user.core"],
                     :name "interface",
                     :namespace "se.example.user.interface"}
                    {:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/components/user/src/se/example/user/core.clj",
                     :imports [],
                     :name "core",
                     :namespace "se.example.user.core"}],
              :test [{:file-path "/Users/joakimtengstrand/source/polylith/examples/doc-example/components/user/test/se/example/user/interface_test.clj",
                      :imports ["clojure.test" "se.example.user.interface"],
                      :name "interface-test",
                      :namespace "se.example.user.interface-test"}]},
 :paths {:src ["src" "resources"], :test ["test"]},
 :type "component"}
----

Component keys are the same as for the base, except that it doesn't have _:base-deps_, plus the _:interfaces_ key:

* `:interface`
** `:definitions` Lists all public _def_, _defn_ and _defmacro_ definitions in the interface namespace.
If a type hint is given, then _:type_ will also be set and be part of the contract.

* `:interface-deps` Lists the interfaces this base depends on.
Here it depends on the _user_ interface from the _src_ context.
This is because the _se.example.user-api.api_ namespace imports _se.example.user.interface_. +
No interfaces are imported from the test context in this example.

* `:lib-deps` Lists the library dependencies this base depends on,
defined in the _:deps_ key in its _deps.edn_ file for the _src_ context,
and the _:aliases_ > _:test_ > _:extra-deps_ for the _test_ context. The _:size_ is in bytes.

* `:lib-imports` The name is a bit misleading as internal namespaces for the base is also included.
** _src_ Lists all imports from the src context except component interfaces.
** `test` Lists all imports from the test context except component interfaces.

* `:lines-of-code` The total number of lines of code for this base (all namespaces included).

* `:name` The name of the directory for this base under the _bases_ directory.

* `:namespaces`
** `:src` Lists all the namespaces that live under the src directory.
*** `:file-path` The absolute path to the namespace.
*** `:imports` Lists all its namespaces.
*** `:is-ignored` Set to true if the namespace is ignored
(by specifying it in the key _:ignored-files_ in workspace.edn.
If ignored, then "warning 206 - Unreadable namespace" will not be triggered.
*** `:is-invalid` Set to true if the namespace is missing or if the file can't be parsed.
*** `:name` The name of the namespace where top namespace + base name
(_se.example_ + user-api in this case) have been stripped away.
*** `:namespace` The full name of the namespace.
** `:test` Lists all the namespaces that live under the test directory (same keys as for the _:src_).
* `:non-top-namespace` If the base contains any non-top namespaces, they will be stored in a vector with elements like this:
** {_:non-top-ns_ "com.wrong", _:file_ "bases/cli/src/com/wrong/cli/interface.clj"}
* `:paths` The paths that are specified in its _deps.edn_ file
(paths for _src_ and _resources_ paths + _aliases_ > _:test_ > _:extra-paths_ for test paths).
* `:type` Set to "base".

== configs

[source,shell]
----
poly ws get:configs
----

[source,clojure]
----
{:bases [{:config {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}}
                   :deps {}
                   :paths ["src" "resources"]}
          :name "cli"}
         {:config {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}}
                   :deps {slacker/slacker {:mvn/version "0.17.0"}}
                   :paths ["src" "resources"]}
          :name "user-api"}]
 :components [{:config {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}}
                        :deps {}
                        :paths ["src" "resources"]}
               :name "user"}
              {:config {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}}
                        :deps {compojure/compojure {:mvn/version "1.6.2"}
                               http-kit/http-kit {:mvn/version "2.4.0"}
                               ring/ring {:mvn/version "1.8.1"}
                               slacker/slacker {:mvn/version "0.17.0"}}
                        :paths ["src" "resources"]}
               :name "user-remote"}]
 :projects [{:config {:aliases {:test {:extra-deps {}, :extra-paths ["test"]}
                                :uberjar {:main se.example.cli.core}}
                      :deps {org.apache.logging.log4j/log4j-core {:mvn/version "2.13.3"}
                             org.apache.logging.log4j/log4j-slf4j-impl {:mvn/version "2.13.3"}
                             org.clojure/clojure {:mvn/version "1.11.1"}
                             poly/cli {:local/root "../../bases/cli"}
                             poly/user-remote {:local/root "../../components/user-remote"}}}
             :name "command-line"}
            {:config {:aliases {:+default {:extra-deps {poly/user {:local/root "components/user"}}
                                           :extra-paths ["components/user/test"]}
                                :+remote {:extra-deps {poly/user-remote {:local/root "components/user-remote"}}
                                          :extra-paths ["components/user-remote/test"]}
                                :build {:deps {io.github.clojure/tools.build {:mvn/version "0.9.4"}
                                               io.github.seancorfield/build-uber-log4j2-handler {:git/sha "55fb6f6"
                                                                                                 :git/tag "v0.1.5"}
                                               org.clojure/tools.deps {:mvn/version "0.16.1281"}}
                                        :ns-default build
                                        :paths ["build/resources"]}
                                :dev {:extra-deps {org.apache.logging.log4j/log4j-core {:mvn/version "2.13.3"}
                                                   org.apache.logging.log4j/log4j-slf4j-impl {:mvn/version "2.13.3"}
                                                   org.clojure/clojure {:mvn/version "1.11.1"}
                                                   poly/cli {:local/root "bases/cli"}
                                                   poly/user-api {:local/root "bases/user-api"}}
                                      :extra-paths ["development/src"]}
                                :poly {:extra-deps {polyfy/polylith {:sha "78b2c77c56d1b41109d68b451069affac935200e"
                                                                     :deps/root "projects/poly"
                                                                     :git/url "https://github.com/polyfy/polylith.git"}}
                                       :main-opts ["-m"
                                                   "polylith.clj.core.poly-cli.core"]}
                                :test {:extra-paths ["bases/cli/test"
                                                     "bases/user-api/test"
                                                     "projects/command-line/test"]}}}
             :name "development"}
            {:config {:aliases {:test {:extra-deps {}, :extra-paths []}
                                :uberjar {:main se.example.user-api.core}}
                      :deps {org.apache.logging.log4j/log4j-core {:mvn/version "2.13.3"}
                             org.apache.logging.log4j/log4j-slf4j-impl {:mvn/version "2.13.3"}
                             org.clojure/clojure {:mvn/version "1.11.1"}
                             poly/user {:local/root "../../components/user"}
                             poly/user-api {:local/root "../../bases/user-api"}}}
             :name "user-service"}]
 :user {:color-mode "dark", :empty-character ".", :thousand-separator ","}
 :workspace {:compact-views #{}
             :default-profile-name "default"
             :interface-ns "interface"
             :projects {"command-line" {:alias "cl"}
                        "development" {:alias "dev"}
                        "user-service" {:alias "user-s"}}
             :release-tag-pattern "v[0-9]*"
             :stable-tag-pattern "stable-*"
             :top-namespace "se.example"
             :vcs {:auto-add true, :name "git"}}}
----

These attributes are described in the xref:configuration.adoc[Configuration] section.

== interface

[source,shell]
----
poly ws get:interfaces:user
----

[source,clojure]
----
{:definitions [{:name "hello",
                :parameters [{:name "name"}],
                :type "function"}],
 :implementing-components ["user" "user-remote"],
 :name "user",
 :type "interface"}
----

* `:definitions` A list of the public _def_, _defn_ and _defmacro_ definitions that are part of the interface.
** `:name` the name of the _def_, _defn_ or _defmacro_ definition. If it's a multi-arity function or macro,
then each arity will be stored separately.
** `:parameters` Set for functions and macros. Specifies the function/macro parameters:
*** `:name` The name of the parameter.
*** `:type` If a type hint, e.g. _^String_ is given, then this attribute is set.
** `:type` Set to "data", "function" or "macro".

* `:name` The name of the interface. In this case the bricks _user_ and _user-remote_ share the same _user_ interface
and live in the _se.example.user.interface_ namespace.

* `:type` Set to "interface".

== messages

[source,shell]
----
poly ws get:messages
----

[source,clojure]
----
[{:code 103,
  :message "Missing definitions in user's interface: hello[name]",
  :colorized-message "Missing definitions in user's interface: hello[name]",
  :components ["user"],
  :type "error"}]
----

To trigger this error, we commented out the hello function from the user component interface.

* `:code` The code of the error or warning. To get a full list of existing codes, execute poly help check.

* `:message` The error message.

* `:colorized-message` The error message using colors so the text can be printed in color.

* `:components` Each error message can have extra keys/information, like affected components as in this case.

* `:type` Set to "error" or "warning".

== name

[source,shell]
----
poly ws get:name
----

[source,clojure]
----
"doc-example"
----

The name of the workspace directory.

== old

[source,shell]
----
poly ws get:old ws-file:ws.edn
----

[source,clojure]
----
{:user-input {:args ["ws" "out:ws.edn"],
              :cmd "ws",
              :is-all false,
              :is-dev false,
              :is-latest-sha false,
              :is-no-exit false,
              :is-run-all-brick-tests false,
              :is-run-project-tests false,
              :is-search-for-ws-dir false,
              :is-show-brick false,
              :is-show-loc false,
              :is-show-project false,
              :is-show-resources false,
              :is-show-workspace false,
              :is-verbose false,
              :out "ws.edn",
              :selected-profiles #{},
              :selected-projects #{},
              :unnamed-args []}}
----

If the workspace is loaded using _ws-file:WS-FILE_ then the _:old_ key is populated.

* `user-input` The user input from the original ws file.

* `:active-profiles` If any profiles are given, then this key is added with the value of _:active-profiles_
taken from the _:settings_ key from the original ws file.

== paths

[source,shell]
----
poly ws get:paths
----

[source,clojure]
----
{:existing ["bases/cli/resources"
            "bases/cli/src"
            "bases/cli/test"
            "bases/user-api/resources"
            "bases/user-api/src"
            "bases/user-api/test"
            "components/user-remote/resources"
            "components/user-remote/src"
            "components/user-remote/test"
            "components/user/resources"
            "components/user/src"
            "components/user/test"
            "development/src"
            "projects/command-line/test"],
 :on-disk ["bases/cli/resources"
           "bases/cli/src"
           "bases/cli/test"
           "bases/user-api/resources"
           "bases/user-api/src"
           "bases/user-api/test"
           "components/user-remote/resources"
           "components/user-remote/src"
           "components/user-remote/test"
           "components/user/resources"
           "components/user/src"
           "components/user/test"
           "projects/command-line/test"],
 :missing []}
----

* `:existing` All existing paths in the workspace that are used in bricks, projects, and profiles.

* `:on-disk` All paths to directories within the workspace.

* `:missing` All missing paths in the workspace that are used in bricks, projects, and profiles but don't exist on disk.

== projects

[source,shell]
----
poly ws get:projects:user-service
----

[source,clojure]
----
{:alias "user-s",
 :base-names {:src ["user-api"], :test ["user-api"]},
 :component-names {:src ["user"], :test ["user"]},
 :config-filename "/Users/joakimtengstrand/source/polylith/examples/doc-example/projects/user-service/deps.edn",
 :deps {"user" {:src {}, :test {}},
        "user-api" {:src {:direct ["user-remote"]},
                    :test {:direct ["user-remote"]}}},
 :is-dev false,
 :lib-deps {:src {"org.apache.logging.log4j/log4j-core" {:size 1714164,
                                                         :type "maven",
                                                         :version "2.13.3"},
                  "org.apache.logging.log4j/log4j-slf4j-impl" {:size 23590,
                                                               :type "maven",
                                                               :version "2.13.3"},
                  "org.clojure/clojure" {:size 3914649,
                                         :type "maven",
                                         :version "1.10.3"},
                  "org.clojure/tools.deps.alpha" {:size 60953,
                                                  :type "maven",
                                                  :version "0.12.1003"},
                  "slacker/slacker" {:size 28408,
                                     :type "maven",
                                     :version "0.17.0"}}},
 :lib-imports {:src ["se.example.user-api.api" "slacker.server"],
               :test ["clojure.test" "se.example.user-api.core"]},
 :lines-of-code {:src 0, :test 0, :total {:src 44, :test 26}},
 :maven-repos {"central" {:url "https://repo1.maven.org/maven2/"},
               "clojars" {:url "https://repo.clojars.org/"}},
 :name "user-service",
 :namespaces {},
 :paths {:src ["bases/user-api/resources"
               "bases/user-api/src"
               "components/user/resources"
               "components/user/src"],
         :test ["bases/user-api/test" "components/user/test"]},
 :project-dir "/Users/joakimtengstrand/source/polylith/examples/doc-example/projects/user-service",
 :type "project"}
----

* `:alias` The alias that is specified in _:projects_ in _workspace.edn_ for this project.

* `:base-names`
** `:src` The bases that are included in the project for the _src_ context, either as paths or included as _:local/root_.
** `:test` The bases that are included in the project for the _test_ context, either as paths or included as _:local/root_.

* `:component-names`
** `:src` The components that are included in the project for the _src_ context, either as paths or included as _:local/root_.
** `:test` The components that are included in the project for the _test_ context, either as paths or included as _:local/root_.

* `:config-filename` The absolute path to the _deps.edn_ config file.

* `:deps` A map with brick names as keys where each brick contains:
** `:src` Keeps track of the dependencies from the `:src` context.
*** `:direct` A vector with the direct dependencies, from the _:src_ directory, to components (component names).
*** `:indirect` A vector with the indirect dependencies, from the _:src_ directory, to components (component names).
*** `:circular` A vector with the circular dependency chain,
translated to the components in the project, e.g. ["a" "b" "c" "a"] from the _:src_ directory.
*** `:missing-ifc-and-bases`
**** `:direct` A vector containing missing interface and brick names, that are directly accessed from the _:src_ directory.
**** `:indirect` A vector containing missing interface and brick names, that are indirectly accessed from the _:src_ directory.
** `:test` Keeps track of the dependencies from the `:test` context, with the same set of keys as the `:src` context.

* `:is-dev` Set to true for the development project.

* `:lib-deps`
** `:src` Stores a map with the libraries that are used in the project for the src context.
*** `:size` The size of this library in bytes.
*** `:type` The type of the library, "maven", "local" or "git" (_:mvn/version_, _:local/root_ and _:git/url_).
*** `:version` The library version:
**** if type is _maven_ then version is set to _groupId/artifactId_.
**** if type is _local_ then the version is set to -.
**** if type is _git_ then the version is set to the first seven characters in the _sha_.
** `:test` Stores a map with the libraries that are used in the project for the test context.

* `:lib-imports`
** `:src` All _:lib-imports_ taken from the bricks that are included in this project for the _src_ context.
** `:test` All _:lib-imports_ taken from the bricks that are included in this project for the _test_ context.

* `:lines-of-code`
** `:src` Number of lines of code living in the project's _src_ directory.
** `:test` Number of lines of code living in the project's _test_ directory.
** `:total` The total number of lines of code for all the bricks that are included in this project.

* `:maven-repos` The maven repos that are used by this project.
If _:mvn/repos_ is specified by a brick that is included in this project, then it will automatically turn up in this list.

* `:name` The name of the project directory under the _projects_ directory.

* `:namespaces` If the project has a _test_ and/or _src_ directory, then the included namespaces are listed here.
** `:src` Lists all the namespaces that live under the src directory.
*** `:file-path` The absolute path to the namespace.
*** `:imports` Lists all its namespaces.
*** `:is-ignored` Set to true if the namespace is ignored
(by specifying it in the _:ignored-files_ key in _workspace.edn_.
If ignored, then "warning 206 - Unreadable namespace" will not be triggered.
*** `:is-invalid` Set to true if the namespace is missing or if the file can't be parsed.
*** `:name` The name of the namespace where top namespace + component name (_se.example_ + _user_ in this case) are stripped away.
*** `namespace` The full name of the namespace.
** `:test` Lists all the namespaces that live under the _test_ directory (same keys as for the _:src_).

* `:paths`
** `:src` Lists the paths that are either explicitly defined as paths or implicitly defined as _:local/root_ bricks, for the _src_ context.
** `:test` Lists the paths that are either explicitly defined as paths or implicitly defined as _:local/root_ bricks, for the _test_ context.
* `:project-dir` The absolute path to the project directory.
* `:type` Set to "project".

== settings

[source,shell]
----
poly ws get:settings
----

[source,clojure]
----
{:active-profiles #{"default"},
 :color-mode "dark",
 :compact-views #{},
 :default-profile-name "default",
 :empty-character ".",
 :interface-ns "interface",
 :m2-dir "/Users/joakimtengstrand/.m2",
 :profile-to-settings {"default" {:base-names [],
                                  :component-names ["user"],
                                  :lib-deps {},
                                  :paths ["components/user/src"
                                          "components/user/resources"
                                          "components/user/test"],
                                  :project-names []},
                       "remote" {:base-names [],
                                 :component-names ["user-remote"],
                                 :lib-deps {},
                                 :paths ["components/user-remote/src"
                                         "components/user-remote/resources"
                                         "components/user-remote/test"],
                                 :project-names []}},
 :projects {"command-line" {:alias "cl"},
            "development" {:alias "dev"},
            "user-service" {:alias "user-s"}},
 :tag-patterns {:release "v[0-9]*", :stable "stable-*"},
 :thousand-separator ",",
 :top-namespace "se.example",
 :user-config-filename "/Users/joakimtengstrand/.config/polylith/config.edn",
 :user-home "/Users/joakimtengstrand",
 :vcs {:auto-add true,
       :branch "master",
       :git-root "/Users/joakimtengstrand/source/polylith",
       :name "git",
       :polylith {:branch "master",
                  :repo "https://github.com/polyfy/polylith.git"},
       :stable-since {:sha "f7e8cd7fe83f6d2fdfdedda35fed5806ac418964",
                      :tag "stable-jote"}}}
----

* `:active-profiles` If any profiles are defined in _./deps.edn_ then the active profiles(s) are listed here.

* `:bricks` A map with configuration information per brick where the keys are brick names, specified in _workspace.edn_:
** `:ignore-files` A vector containing file or file paths to ignore,
e.g.: _["myfile.clj" "myns/another_file.clj" "com/myns/a-thrird-file.clj"]_. See xref:validations.adoc#ignore-files[Validations].

[#color-mode]
* `:color-mode` The color mode specified in _~/.config/polylith/config.edn_.

* `:compact-views` The set of views that should be shown in a more compact way, specified in _workspace.edn_.

* `:default-profile-name` The name of the default profile name, specified in _workspace.edn_.

* `:empty-character` The character used to represent empty space in output from e.g. the libs command, specified in _workspace.edn_.

* `:interface-ns` The name of the namespace/package that is used to represent interfaces, specified in _workspace.edn_.

* `:m2-dir` Maven user root directory. Set to "~/.m2" by default, but can be overridden in _~/.config/polylith/config.edn_.

* `:profile-to-settings` A map with profile name as key and profile definition as value, specified as aliases starting with a + in _./deps.edn_:
** `:base-names` The bases that are referenced from the specified paths.
** `:component-names` The components that are referenced from the specified paths.
** `:lib-deps` The library dependencies specified by the key _:extra-deps_.
** `:paths` The paths specified by the key _:extra-paths_.
** `:project-names` The projects that are referenced from the specified paths.

* `:projects` A map with extra information per project, specified in _workspace.edn_.
** `:alias` The alias for a project, used by e.g. the _info_ command.
** `:ignore-files` A vector containing file or file paths to ignore,
e.g.: _["myfile.clj" "myns/another_file.clj" "com/myns/a-thrird-file.clj"]_.
All files ending with the specified files () will be ignored, or to be exact,
if it's an exact match or if it ends with _/_ + the string. Dashes (-) will be replaced by underscores (_).
** `:necessary` If we get warning 206 (Unreadable namespace in brick/project)
and know that the brick(s) has to be included in the project,
then we can add the necessary bricks(s) to the project in a vector for this key.
** `:test`
*** `:include` Specifies which bricks should be included when running the test command. Empty if no bricks, missing if all bricks.
*** `:exclude` Specifies which brick should be excluded when running the test command.

* `:tag-patterns` The tag patterns that are specified in _workspace.edn_.

* `:thousand-separator` Used by numbers >= 1000 (e.g. the KB column in the libs command) specified in _~/.config/polylith/config.edn_.

* `:top-namespace` The top namespace for the workspace, specified in _workspace.edn_.

* `:user-config-filename` The full path to the user config filename.

* `:user-home` The user home, specified by the user.home environment variable.

* `vcs`
** `:auto-add` Set to _true_ if files and directories created by the create command should be automatically added to git.
Specified in _workspace.edn_.
** `:branch` The name of the git branch.
** `:git-root` The root of the git repository.
** `:name` Set to "git".
** `:polylith`
*** `:branch` Set to _master_ or _BRANCH_ if _branch:BRANCH_ is given.
The branch is used when calculating the latest sha in _./deps.edn_ for the key _:aliases_ > _:poly_ > _:extra-deps_ > _sha_.
*** `:repo` Set to "https://github.com/polyfy/polylith.git".
** `:stable-since`
*** `:sha` The latest stable point in time.
*** `:tag` The tag for the latest stable point in time (if exists).

== user-input

[source,shell]
----
poly ws get:user-input
----

[source,clojure]
----
{:args ["ws" "get:user-input"]
 :cmd "ws"
 :is-all false
 :is-commit false
 :is-compact false
 :is-dev false
 :is-fake-poly false
 :is-latest-sha false
 :is-no-changes false
 :is-no-exit false
 :is-outdated false
 :is-run-all-brick-tests false
 :is-run-project-tests false
 :is-search-for-ws-dir false
 :is-shell false
 :is-show-brick false
 :is-show-loc false
 :is-show-project false
 :is-show-resources false
 :is-show-workspace false
 :is-tap false
 :is-verbose false
 :selected-profiles #{}
 :selected-projects #{}
 :unnamed-args []}
----

We also have a number of arguments that are only populated if they are passed in as a parameter:

[source,clojure]
----
{:branch "master"
 :changed-files ["images/doc.png" "workspace.edn"]
 :color-mode "none"
 :dir "../clojure-polylith-realworld-example-app"
 :fake-sha "c91fdad"
 :fake-tag "stable-lisa"
 :file "usermanager.edn"
 :get "user-input"
 :interface "user"
 :is-git-add true
 :out "example.edn"
 :replace [{:from "this", :to "that"}]
 :selected-bricks ["user"]
 :since "previous-release"
 :skip ["dev"]
 :top-ns "se.example"
 :ws-dir "examples/doc-example"
 :ws-file "realworld.edn"
}
----

* `:args` The arguments to the _poly_ tool where the first argument is the command.

* `:branch` Used in the xref:commands.adoc#create-workspace[create workspace] command
to give the branch, otherwise the workspace will be created in the _main_ branch.

* `:changed-files` Overrides the real xref:changed-files[changed-files] that is retrieved from a git.

* `:cmd` The first argument to the _poly_ tool.

* `:color-mode` Overrides the xref:color-mode[color-mode].

* `:dir` Used by the xref:commands.adoc#switch-ws[switch-ws] command.

* `:fake-sha` Overrides the "stable since" _sha_ in the output from the xref:commands.adoc#info[info] command.
Used when taking screenshots for this documentation.

* `:fake-tag` Sets the tag (or clears it if "") used by the xref:commands.adoc#info[info] command.
Sometimes used when taking screenshots for this documentation.

* `:file` Used by the xref:commands.adoc#switch-ws[switch-ws] command.

* `:get` Used by the xref:commands.adoc#ws[ws] command.

* `:interface` Used by the xref:commands.adoc#create-component[create component] command.

* `:is-all` Set to _true_ if _:all_ is given.

* `:is-commit` Set to _true_ if _:commit_ is given.

* `:is-compact` Set to _true_ if _:compact_ is given. Used in combination with the _libs_ and _deps_ commands.

* `:is-dev` Set to _true_ if _:dev_ is given.

* `:is-fake-poly` Set to _true_ if _:fake-poly_ is given.
Used when using the _polyx_ tool with the _help_ command,
and when starting a _shell_ with `poly shell :fake-poly` where the latter will show e.g. "poly 0.2.18" as version,
instead of e.g. "polyx 0.2.18-issue318-02".

* `:is-git-add` Used by the xref:commands.adoc#create-component[create component],
xref:commands.adoc#create-base[create base] and xref:commands.adoc#create-project[create project] commands
to add created files to git. Has the same effect for current command as if _:vcs:_ > _:auto-add_ was set to _true_
in _workspace.edn_.

* `:is-latest-sha` Set to _true_ if _:latest-sha_ is given.

* `:is-no-changes` Set to _true_ if _:no-changes_ is given. Used to fake that no changes have been made since the last stable point in time.

* `:is-no-exit` Set to _true_ if _:no-exit_ is given. This will prevent the _poly_ tool from exiting with _System/exit_.

* `:is-outdated` Set to _true_ if _:outdated_ is given.

* `:is-run-all-brick-tests` Set to _true_ if _:all_ or _:all-bricks are given_.

* `:is-run-project-tests` Set to _true_ if _:all_ or _:project_ are given.

* `:is-shell` Set to _true_ if a shell has been started with the shell command.

* `:is-search-for-ws-dir` Set to _true_ if _::_ is given.

* `:is-show-brick` Set to _true_ if _:brick_ is given. Used by poly help deps _:brick_ to show help for the deps command when _brick:BRICK_ is given.

* `:is-show-loc` Set to _true_ if _:loc_ is given. If given, then the _info_ command will show the number of lines of code.

* `:is-show-project` Set to _true_ if _:project_ is given.
Used by poly help deps _:project_ to show help for the deps command when _project:PROJECT_ is given.

* `:is-show-resources` Set to _true_ if _:r_ or _:resources_ is given.
This will tell the _info_ command to show the _r_ status flag.

* `:is-show-workspace` Set to _true_ if _:workspace_ is given.
Used by `poly help deps :workspace` to show help for the deps command when _workspace:WORKSPACE_ is given.

* `:is-tap` Set to _true_ if _:tap_ is given.

* `:is-verbose` Used in combination with the _test_ command to show extra information.

* `:out` Mainly used by the xref:commands.adoc#ws[ws] command,
but can also be passed in to the xref:commands.adoc#info[info], xref:commands.adoc#deps[deps],
and xref:commands.adoc#libs[libs] commands to generate a text file from the output.
This is also available in the xref:commands.adoc#overview[overview] command if using the xref:polyx.adoc[polyx] tool.

* `:replace` Used in tests when maintaining the _poly_ tool itself, to make the output more stable.
Set to e.g. _[{:from "this", :to "that"}]_ if _replace:this:that_ is given.
More than one pair of values can be passed in, separated with :.

* `:selected-bricks` A vector of bricks. The key is only populated if _bricks:_ is given.
Used by the xref:commands.adoc#info[info] and xref:commands.adoc#test[test] commands.

* `:selected-profiles` A vector of profiles, e.g. _["default" "extra"]_, if `poly info +default +extra` is executed.
Used by the xref:commands.adoc#info[info] and xref:commands.adoc#test[test] commands.

* `:selected-projects` A vector of projects. Used by the xref:commands.adoc#info[info] and xref:commands.adoc#test[test] commands.

* `:since` Finds the corresponding key in _:tag-patterns_ in _workspace.edn_
and uses that regex to find the latest matching tag/sha in the git repository,
which is _the latest stable point in time_ used by various commands.

* `:skip` Used to skip projects, as if they never existed.
Often used to skip the development project, in e.g. the xref:commands.adoc#ws[ws] commands.

* `:top-ns` The top namespace, used by the xref:commands.adoc#create-workspace[create workspace] command.

* `:unnamed-args` All given arguments that don't contain a `:`.
So if we type `poly ws get:user-input:unnamed-args :flag arg xx:123` it will return _["arg"]_ but not _xx_.

* `:ws-dir` If set, holds the workspace directory we have switched to.
Can either be explicitly passed in together with the `poly` command,
or implicitly set by the xref:commands.adoc#switch-ws command, using the _dir_ parameter.

* `:ws-file` If set, holds the filename of the exported workspace we have switched to.
Can either be explicitly passed in together with the `poly` command,
or implicitly set by the xref:commands.adoc#switch-ws, using the _file_  parameter.

== version

[source,shell]
----
poly ws get:version
----

[source,clojure]
----
{:release {:date "2023-07-24"
           :major 0
           :minor 2
           :name "0.2.18-issue318-02"
           :patch 18
           :revision "issue318-02"
           :tool "poly"}
 :test-runner-api {:breaking 1
                   :non-breaking 0}
 :ws {:breaking 2
      :non-breaking 0
      :type :toolsdeps2}}
----

* `:release`
** `:date` The date of the release in the format _yyyy-mm-dd_.
for generating image files and the _overview_ command.
** `:major` The major version, set to zero.
** `:minor` Increased by one if any breaking changes.
** `:name` The full name of the release.
** `:patch` Increased by one for each release within a given _major.minor_.
** `:revision` What comes after _major.minor.path_.
** `:tool` Set to "poly" if the _poly_ tool, or "polyx" if the extended _poly_ tool that includes support for creating images.

* `:test-runner-api` Versioning of the test runner API:
** `:breaking` Increased by one if introducing a non-backward compatible change of the test runner API.
** `:non-breaking` Increased by one when a non-breaking change is made to the test runner API.

* `:ws` Versioning of the internal workspace format, returned by poly _ws_.
** `:breaking` Increased by one if introducing a non-backward compatible change of the ws format.
** `:non-breaking` Increased by one when a non-breaking change is made to the ws format.
** `:type` Set to _:toolsdeps1_ if the workspace was created by _v0.1.0-alpha9_ or earlier
(where each brick doesn't have its own _deps.edn_ file).
Set to _:toolsdeps2_ if the workspace was created by _v0.2.0-alpha10_ or later
(where each brick has its own _deps.edn_ file).

* `:from` Set to the value of _:version_ if the workspace is read from a file,
produced by a different version than the current version of the _poly_ tool,
or if the workspace is read from a directory that has not been migrated from _:toolsdeps1_ to _:toolsdeps2_.
** `:release-name` The version of the _poly_ tool from which this ws file was created.
** `:ws`
*** `:breaking` The breaking version of the original _ws_ format.
*** `:non-breaking` The non-breaking version of the original _ws_ format.
*** `:type` The type of the original _ws_ file.

Changes to the _workspace structure_, is documented in the
https://github.com/polyfy/polylith/blob/9053b190d5f3b0680ac4fe5c5f1851f7c0d40830/components/version/src/polylith/clj/core/version/interface.clj#L37-L57[version] component.

== ws-dir

[source,shell]
----
poly ws get:ws-dir
----

[source,clojure]
----
"/Users/joakimtengstrand/source/polylith/examples/doc-example"
----

The absolute path of the workspace directory.

== ws-local-dir

[source,shell]
----
poly ws get:ws-local-dir
----

[source,clojure]
----
"examples/doc-example"
----

If the workspace lives at the same level as the git root,
which will be the case if we create a workspace outside a git repository,
or within an existing without giving a name, then this attribute is not set.
If the workspace lives inside the git root as a directory or subdirectory,
which will be the case if we create the workspace inside an existing repository and giving it a name,
then it is set to the relative path to the git root.

== ws-reader

[source,shell]
----
poly ws get:ws-reader
----

[source,clojure]
----
{:file-extensions ["clj" "cljc"],
 :language "Clojure",
 :name "polylith-clj",
 :project-url "https://github.com/polyfy/polylith",
 :type-position "postfix"}
----

This structure explains different aspects of the tool that created this _workspace structure_
(the _poly_ tool in this case) and the idea is that new tooling could support the _workspace format_
and populate this structure so that it can be used by external tooling.

* `:file-extensions` Lists the supported file extensions.

* `:language` The name of the supported language.

* `:name` The name of the workspace reader.

* `:project-url` The URL to the workspace reader tool.

* `:type-position` Set to _postfix_ because types (type hints) come before the arguments, in Clojure, e.g. _^String arg_.
In some other languages like Scala, the types come after the arguments.

== ws-type

[source,shell]
----
poly ws get:ws-type
----

Outputs the type of workspace:

* With start from version https://github.com/polyfy/polylith/releases/tag/v0.2.0-alpha10[0.2.10-alpha]
we store _deps.edn_ files in each brick, see https://github.com/polyfy/polylith/issues/66[issue 66].
These workspaces will have _ws-type_ set to _:toolsdeps2_.

* All older versions (https://github.com/polyfy/polylith/releases/tag/v0.1.0-alpha9[0.1.0-alpha9] and older)
will have _ws-type_ set to _:toolsdeps1_.
