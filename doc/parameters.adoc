= Parameters

There are a few parameters that are either rarely used, added to simplify maintenance work with the Polylith codebase,
or used in special circumstances. For these reasons, they are not suggested by the autocomplete when in a shell.
What most of them have in common is that they are used to control the output of the different `poly` commands.

The internal help for these parameters can be access by executing `poly help`.

=== all

If passing in `:all` to the xref:commands.adoc[help] command, the help for the  xref:commands.adoc#migrate[migrate] command will also be included:

[source,shell]
----
poly help :all
----

We can also pass in `:all` when starting a shell:

[source,shell]
----
poly :all
----

This will give us access to all available parameters, even those that are rarely used (which are often just in the way)
and parameters that only make sense when developing the `poly` tool itself.
For example, `workspace` will be available when using the xref:commands.adoc#create[create] command.

The reason it's not included by default is that we seldom want to create another workspace within the current workspace:

image::images/misc/poly-all.png[]

Examples of other parameters that will also be available for some commands:
`changed-files`, `color-mode`, `:compact`, `:local:`, `:no-changes`, `out`, `skip`, `+`.

=== branch

By passing in `branch` to the doc command together with `page`, the corresponding document opens in github, e.g.:

[source,shell]
----
poly doc page:install branch:master
----

If we start a xref:commands.adoc#shell[shell] and passes in `:all`, we will get suggestions for existing branches:

[source,shell]
----
poly :all
myws$ doc branch:master page:install
----

=== changed-files

This parameter is used to fake changes of files, and is used for testing purposes when developing the `poly` tool itself, e.g:

[source,shell]
----
poly info changed-files:components/file/polylith/clj/core/user_input/core.clj
----

More than one file can be marked as changed by separating them with colons (the autocomplete only works for the first file at the moment).

it's enough to include the brick or project name plus a slash, and the tool will treat the brick/project as changed, e.g.:

[source,shell]
----
poly info changed-files:bases/mybase/:components/mycomponent/:projects/myproject/
----

=== fake-sha

This parameter can be passed in to fake a `sha` when executing the xref:commands.adoc#info[info] command,
which is used when taking screenshots for this documentation.

[source,shell]
----
poly info fake-sha:c91fdad
----

=== fake-tag

This parameter can be passed in to fake a `tag` when executing the xref:commands.adoc#info[info] command,
which sometimes is used when taking screenshots for this documentation, e.g.:

[source,shell]
----
poly info fake-tag:stable-lisa
----

The tag can be removed with:

[source,shell]
----
poly info fake-tag:
----

=== fake-poly

This parameter is used to fake that we are running the `poly` tool,
when we actually run the `polyx` tool. Only used by the help command:

[source,shell]
----
poly help :fake-poly
----

=== latest-sha

This parameter is used to tell the tool to fetch the latest sha from the git repo (otherwise it's not populated), e.g.:

[source,shell]
----
poly ws get:settings:vcs:polylith:latest-sha :latest-sha
----

=== local

This parameter can be passed in to the xref:commands.adoc#doc[doc] command to open pages that runs on localhost.
To run the cljdoc documentation locally, we can start by cloning the https://github.com/polyfy/polylith[polylith] repo:

[source,shell]
----
git clone git@github.com:polyfy/polylith.git
----

This is how the help for the
https://github.com/polyfy/polylith/blob/0d204094cb597cea6be417ab05baa2139b78e6d1/bb.edn#L20[doc]
command looks like:

[source,shell]
----
cd polylith
bb doc help

Commands:
 start   Start docker containers supporting cljdoc preview
 ingest  Locally publishes poly for cljdoc preview
 view    Opens cljdoc preview in your default browser
 stop    Stops docker containers supporting cljdoc preview
 status  Status of docker containers supporting cljdoc preview
 help    Show this help
----

Now we can start the server and publish the documentation locally (which takes some time!):

[source,shell]
----
bb doc start
bb doc ingest
----

Before we can run the `poly` tool from a workspace, we need to add or replace the `:poly` alias
in that workspace (e.g. `myws/deps.edn`):

[source,clojure]
----
    ...
    :poly {:main-opts ["-m" "polylith.clj.core.poly-cli.core"]
           :extra-deps {polylith/clj-poly {:local/root "../polylith/projects/poly"}}}

----

Make sure the "../polylith/projects/poly" path points to the `poly` project in the cloned `polylith` workspace directory.

Now we can use the `poly` tool from our workspace:

[source,shell]
----
cd myws
clojure -M:poly doc page:component :local
----

A more convenient way is to start a xref:commands.adoc#shell[shell] and pass in `:local`, e.g.:

[source,shell]
----
clojure -M:poly shell :local
myws$ doc page:component
myws$ doc help:check
myws$ doc ws:components
----

Sometimes the cljdoc platform that builds the documentation has changed,
and in that case we need to restart the Docker container to get the latest version:

[source,shell]
----
bb doc stop
bb doc start
----

If the polylith codebase is changed, e.g. if we retrieve more commits or if we switch branch,
we have to run `ingest` again to get the latest and greatest (the server doesn't need to be restarted):

[source,shell]
----
bb doc ingest
----

Viewing the documentation locally is used when developing the `poly` tool itself,
but can be useful if we want to work against the `master` branch
and get easy access to the latest updates of the documentation.

=== no-changes

This parameter can be used to fake that no changes have been made since the last stable point in time,
and can be used when taking a screenshot of the xref:commands.adoc#info[info] command without getting the `*` characters.

* `poly diff :no-changes` Returns no rows.
* `poly info :no-changes` Gets rid of the * characters.

Has the same effect as:

[source,shell]
----
poly info changed-files:
----

=== no-exit

When the `poly` tool is executed, it exits with `System/exit` internally, see
https://github.com/polyfy/polylith/blob/edaef89207c2852010132e863ae87ebba5bedc5b/bases/poly-cli/src/polylith/clj/core/poly_cli/core.clj#L33[poly-cli].
If executing the `poly` tool from a REPL, this will also exit the REPL.
To avoid that, we can pass in
https://github.com/polyfy/polylith/blob/9053b190d5f3b0680ac4fe5c5f1851f7c0d40830/bases/poly-cli/src/polylith/clj/core/poly_cli/core.clj#L31-L32[:no-exit].

If we execute `poly info :no-exit` we have to press `<ctrl>+C` to exit, which is not so useful!

=== replace

This parameter is used to manipulate the output from the xref:commands.adoc#ws[ws] command.
When we execute `poly ws get:settings:user-home` it will return something like "/Users/joakimtengstrand".
We can tell the xref:commands.adoc#ws[ws] command to search for strings (using regular expressions) and replace the occurrences with another string,
e.g. (assumes that $HOME is set):

* `poly ws get:settings:user-home replace:$HOME:MY-HOME` Outputs: "MY-HOME".

* `poly ws get:settings:user-config-filename replace:$HOME:MY-HOME` Outputs: "MY-HOME/.polylith/config.edn".

* `poly ws get:settings:user-config-filename replace:$HOME:MY-HOME:config.edn:USER-CONFIG` Outputs: "MY-HOME/.polylith/USER-CONFIG".

* `poly ws get:settings:vcs:stable-since:sha replace:"[0-9]+":"*"` Outputs "*e*d*b*cee*fb*e*ff*fafcf".
Here we need to surround the regular expressions with "" for the terminal to ignore the special characters.
