= Parameters

There are a few parameters that are either rarely used, added to simplify maintenance work with the Polylith codebase,
or used in special circumstances. For these reasons, they are not suggested by the autocomplete when in a shell.
What most of them have in common is that they are used to control the output of the different _poly_ commands.

The internal help for these parameters can be access by executing `poly help`.

=== all

If passing in _:all_ to the xref:commands.adoc[help] command, the help for the  xref:commands.adoc#migrate[migrate] command will also be included:

[source,shell]
----
poly help :all
----

We can also pass in _:all_ when starting a shell:

[source,shell]
----
poly :all
----

This will give us access to all available parameters, even those that are rarely used (which are often just in the way)
and parameters that only make sense when developing the _poly_ tool itself.
For example, _workspace_ will be available when using the xref:commands.adoc#create[create] command.

The reason it's not included by default is that we seldom want to create another workspace within the current workspace:

image::images/misc/poly-all.png[]

Examples of other parameters that will also be available for some commands:
_changed-files_, _color-mode_, _:compact_, _:local:_, _:no-changes_, _out_, _skip_, _+_.

=== branch

By passing in _branch_ to the doc command together with _page_, the corresponding document opens in github, e.g.:

[source,shell]
----
poly doc page:install branch:master
----

If we start a xref:commands.adoc#shell[shell] and passes in _:all_, we will get suggestions for existing branches:

[source,shell]
----
poly :all
myws$ doc branch:master page:install
----

=== changed-files

This parameter is used to fake changes of files, and is used for testing purposes when developing the _poly_ tool itself, e.g:

[source,shell]
----
poly info changed-files:components/file/polylith/clj/core/user_input/core.clj
----

More than one file can be marked as changed by separating them with colons (the autocomplete only works for the first file at the moment).

it's enough to include the brick or project name plus a slash, and the tool will treat the brick/project as changed, e.g.:

[source,shell]
----
poly info changed-files:bases/mybase/:components/mycomponent/:projects/myproject/
----

=== commit

This parameter is only suggested if we are outside a git repository.
The _:auto-add_ parameter in the _:vcs_ section in _workspace.edn_,
can be set to true to automatically add files to git when executing the xref:commands.adoc#create[create] command
(we normally want to set it to _false_).
If set to _false_, we can pass in _:commit_ to get the same effect, e.g.:

[source,shell]
----
poly create component name:mycomp :commit
----

=== fake-sha

This parameter can be passed in to fake a _sha_ when executing the _info_ command,
which is used when taking screenshots for this documentation.

[source,shell]
----
poly info fake-sha:c91fdad
----

=== fake-tag

This parameter can be passed in to fake a _tag_ when executing the _info_ command,
which sometimes is used when taking screenshots for this documentation, e.g.:

[source,shell]
----
poly info fake-tag:stable-lisa
----

The tag can be removed with:

[source,shell]
----
poly info fake-tag:
----

=== fake-poly

This parameter is used to fake that we are running the _poly_ tool,
when we actually run the _polyx_ tool. Only used by the help command:

[source,shell]
----
poly help :fake-poly
----

=== latest-sha

This parameter is used to tell the tool to fetch the latest sha from the git repo (otherwise it's not populated), e.g.:

[source,shell]
----
poly ws get:settings:vcs:polylith:latest-sha :latest-sha
----

=== local

This parameter can be passed in to the xref:commands.adoc#doc[doc] command to open pages that runs on localhost.
To run the cljdoc locally, we can start by cloning the https://github.com/polyfy/polylith[polylith] repo:

[source,shell]
----
git clone git@github.com:polyfy/polylith.git
----

This is how the help for the
https://github.com/polyfy/polylith/blob/0d204094cb597cea6be417ab05baa2139b78e6d1/bb.edn#L20[doc]
command looks like:

[source,shell]
----
cd polylith
bb doc help

Commands:
 start   Start docker containers supporting cljdoc preview
 ingest  Locally publishes poly for cljdoc preview
 view    Opens cljdoc preview in your default browser
 stop    Stops docker containers supporting cljdoc preview
 status  Status of docker containers supporting cljdoc preview
 help    Show this help
----

Now we can start the server and publish the documentation locally (which takes some time!):

[source,shell]
----
bb doc start
bb doc ingest
----

Before we can run the _poly_ command from a workspace, we need to add or replace the _:poly_ alias
in that workspace (e.g. _myws/deps.edn_):

[source,clojure]
----
    ...
    :poly {:main-opts ["-m" "polylith.clj.core.poly-cli.core"]
           :extra-deps {polylith/clj-poly {:local/root "../polylith/projects/poly"}}}

----

Make sure the "../polylith/projects/poly" path points to the _poly_ project in the cloned _polylith_ workspace directory.

Now we can use the _poly_ tool from our workspace:

[source,shell]
----
cd myws
clojure -M:poly doc page:component :local
----

A more convenient way is to start a xref:commands.adoc#shell[shell] and pass in _:local_, e.g.:

[source,shell]
----
clojure -M:poly shell :local
myws$ doc page:component
myws$ doc help:check
myws$ doc ws:components
----

Sometimes the cljdoc platform that builds the documentation is changed, then we need to restart the Docker container:

[source,shell]
----
bb doc stop
bb doc start
----

If the polylith codebase is changed, e.g. if we retrieve more commits or if we switch branch,
then we have to run _ingest_ again to get the latest and greatest (the server doesn't need to be restarted):

[source,shell]
----
bb doc ingest
----

Viewing the documentation locally is used when developing the _poly_ tool itself,
but can be useful if we want to work against the _master_ branch
and get easy access to the latest updates of the documentation.

=== no-changes

This parameter can be used to fake that no changes have been made since the last stable point in time,
and can be used when taking a screenshot of the _info_ command without getting the * characters.

* `poly diff :no-changes` Returns no rows.
* `poly info :no-changes` Gets rid of the * characters.

Has the same effect as:

[source,shell]
----
poly info changed-files:
----

=== no-exit

When the _poly_ command is executed, it exits with _System/exit_ internally, see poly-cli.
If executing the _poly_ tool from a REPL, this will also exit the REPL.
To avoid that, we can pass in
https://github.com/polyfy/polylith/blob/9053b190d5f3b0680ac4fe5c5f1851f7c0d40830/bases/poly-cli/src/polylith/clj/core/poly_cli/core.clj#L31-L32[:no-exit].

If we execute `poly info :no-exit` we have to press _Ctrl+C_ to exit, which is not so useful!

=== replace

This parameter is used to manipulate the output from the xref:commands.adoc#ws[ws] command.
When we execute `poly ws get:settings:user-home` it will return something like "/Users/joakimtengstrand".
We can tell the _ws_ command to search for strings (using regular expressions) and replace the occurrences with another string,
e.g. (assumes that $HOME is set):

* `poly ws get:settings:user-home replace:$HOME:MY-HOME` Outputs: "MY-HOME".

* `poly ws get:settings:user-config-filename replace:$HOME:MY-HOME` Outputs: "MY-HOME/.polylith/config.edn".

* `poly ws get:settings:user-config-filename replace:$HOME:MY-HOME:config.edn:USER-CONFIG` Outputs: "MY-HOME/.polylith/USER-CONFIG".

* `poly ws get:settings:vcs:stable-since:sha replace:"[0-9]+":"*"` Outputs "*e*d*b*cee*fb*e*ff*fafcf".
Here we need to surround the regular expressions with "" for the terminal to ignore the special characters.
